name: Build RBXRemake and RbxRemakeStudio iOS Apps

on:
  push:
    branches: [main]

jobs:
  build_both_apps:
    runs-on: macos-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Run build script
        run: ./build_ios_apps.sh
        id: build_script_output

      - name: Upload RBXRemake IPA (if successful)
        uses: actions/upload-artifact@v3
        if: success() && jobs.build_both_apps.status == 'success'
        with:
          name: RBXRemake-ipa
          path: ${{ jobs.build_script_output.outputs.rbxremake_ipa_path }}

      - name: Upload RbxRemakeStudio IPA (if successful)
        uses: actions/upload-artifact@v3
        if: success() && jobs.build_both_apps.status == 'success'
        with:
          name: RbxRemakeStudio-ipa
          path: ${{ jobs.build_script_output.outputs.rbxremakestudio_ipa_path }}
