name: iOS CMake Build (No Provisioning or Code Signing)

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: macos-latest
    steps:
    - name: Checkout source code
      uses: actions/checkout@v3

    - name: Set up CMake
      uses: jwlawson/actions-setup-cmake@v1
      with:
        cmake-version: '3.20.0'

    - name: Install dependencies
      run: |
        # Install any additional dependencies if needed
        brew install ninja
        brew install cmake

    - name: Configure CMake for iOS without Code Signing
      run: |
        cmake -S . -B build \
          -G Xcode \
          -DCMAKE_SYSTEM_NAME=iOS \
          -DCMAKE_OSX_DEPLOYMENT_TARGET=14.0 \
          -DCMAKE_OSX_ARCHITECTURES="arm64" \
          -DCMAKE_XCODE_ATTRIBUTE_CODE_SIGNING_ALLOWED=NO \
          -DCMAKE_XCODE_ATTRIBUTE_CODE_SIGNING_REQUIRED=NO \
          -DCMAKE_XCODE_ATTRIBUTE_PROVISIONING_PROFILE="" \
          -DCMAKE_XCODE_ATTRIBUTE_DEVELOPMENT_TEAM="" \
          -DCMAKE_XCODE_ATTRIBUTE_CODE_SIGN_IDENTITY=""

    - name: Build with Xcode for iOS
      run: |
        xcodebuild -project build/YourProject.xcodeproj \
          -scheme YourScheme \
          -sdk iphoneos \
          -configuration Release \
          -derivedDataPath build/derivedData \
          CODE_SIGNING_ALLOWED=NO CODE_SIGNING_REQUIRED=NO PROVISIONING_PROFILE_SPECIFIER="" CODE_SIGN_IDENTITY="" DEVELOPMENT_TEAM=""

    - name: Archive .app
      run: |
        # Replace with the correct path to your .app file
        mkdir -p build/artifacts
        cp -R build/derivedData/Build/Products/Release-iphoneos/YourApp.app build/artifacts

    - name: Upload .app artifact
      uses: actions/upload-artifact@v3
      with:
        name: ios-app
        path: build/artifacts/YourApp.app
